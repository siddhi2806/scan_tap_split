(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[398],{3977:function(e,t,s){Promise.resolve().then(s.bind(s,9211))},9211:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return n}});var r=s(7437),a=s(2265),l=s(6463);function n(){let[e,t]=(0,a.useState)(null),[s,n]=(0,a.useState)(null),[o,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null),[m,u]=(0,a.useState)(null),p=(0,l.useRouter)(),g=e=>{t(e),d(null),u(null);let s=new FileReader;s.onload=e=>{var t;n(null===(t=e.target)||void 0===t?void 0:t.result)},s.readAsDataURL(e)},x=e=>new Promise((t,s)=>{let r=new FileReader;r.readAsDataURL(e),r.onload=()=>{t(r.result.split(",")[1])},r.onerror=e=>s(e)}),h=async()=>{if(!e){d("Please select an image first");return}i(!0),d(null),u(null);try{console.log("Starting receipt processing...");let t=await x(e);console.log("Image converted to base64, length:",t.length);let s=await fetch("/api/scrape",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({base64Image:t})});if(console.log("API response status:",s.status),!s.ok){let e=await s.text();throw console.error("API error:",e),Error("Failed to process receipt: ".concat(s.status," ").concat(e))}let r=await s.json();if(console.log("API response data:",r),!r.items||!Array.isArray(r.items))throw Error("Invalid response format from API");r.message&&(console.log("API message:",r.message),u(r.message)),localStorage.setItem("extractedItems",JSON.stringify(r.items)),setTimeout(()=>{p.push("/edit-receipt")},r.message?2e3:500)}catch(e){console.error("Receipt processing error:",e),d(e instanceof Error?e.message:"An error occurred while processing the receipt")}finally{i(!1)}};return(0,r.jsxs)("main",{className:"flex flex-col items-center justify-center min-h-screen p-4 max-w-2xl mx-auto",children:[(0,r.jsx)("button",{onClick:()=>p.back(),className:"self-start mb-4 text-orange-500 hover:underline",children:"← Back"}),(0,r.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Scan Receipt"}),(0,r.jsx)("p",{className:"text-gray-500 mb-6 text-center",children:"Take a photo or upload an image of your receipt"}),(0,r.jsx)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 mb-6 w-full max-w-md text-center cursor-pointer hover:border-orange-400 transition-colors",onDrop:e=>{e.preventDefault();let t=e.dataTransfer.files[0];t&&t.type.startsWith("image/")?g(t):d("Please drop an image file")},onDragOver:e=>{e.preventDefault()},onClick:()=>{var e;return null===(e=document.getElementById("fileInput"))||void 0===e?void 0:e.click()},children:s?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("img",{src:s,alt:"Receipt preview",className:"max-w-full max-h-64 mx-auto rounded-lg shadow-md"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Click to change image"})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("span",{className:"text-6xl",children:"\uD83D\uDCF7"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-black font-medium",children:"Take a photo"}),(0,r.jsx)("p",{className:"text-gray-500",children:"or upload receipt"}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Drag and drop an image here, or click to select"})]})]})}),(0,r.jsx)("input",{id:"fileInput",type:"file",accept:"image/*",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&(s.type.startsWith("image/")?g(s):d("Please select an image file"))},className:"hidden"}),m&&(0,r.jsxs)("div",{className:"mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg",children:[(0,r.jsx)("p",{className:"font-medium",children:"Success!"}),(0,r.jsx)("p",{className:"text-sm",children:m}),(0,r.jsx)("p",{className:"text-xs mt-2 text-green-600",children:"Redirecting to edit page..."})]}),c&&(0,r.jsxs)("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:[(0,r.jsx)("p",{className:"font-medium",children:"Error:"}),(0,r.jsx)("p",{className:"text-sm",children:c}),(0,r.jsx)("p",{className:"text-xs mt-2 text-red-600",children:"If you're testing, the app will use mock data when the image processing fails."})]}),(0,r.jsx)("button",{onClick:h,disabled:!e||o,className:"bg-orange-500 text-white px-8 py-3 rounded-lg shadow hover:bg-orange-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:o?"Processing...":"Scrape the Bill"}),e&&(0,r.jsxs)("p",{className:"mt-4 text-sm text-gray-600",children:["Selected: ",e.name]})]})}},6463:function(e,t,s){"use strict";var r=s(1169);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=3977)}),_N_E=e.O()}]);